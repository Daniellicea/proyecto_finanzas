{% extends "base.html" %}
{% block content %}
<div class="row mb-4 align-items-center border-bottom pb-3">
    <div class="col-md-8">
        <span class="badge bg-primary text-white mb-2 text-uppercase tracking-wide">Pilar 1 de Widata</span>
        <h2 style="color: var(--nu-purple);" class="fw-bold d-flex align-items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon-nu me-2" style="width:36px;height:36px;" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>
            Motor de Estrategias de Pago
        </h2>
        <p class="text-muted">Algoritmos que analizan tus tasas de interés para recomendarte qué deuda liquidar primero.</p>
    </div>
    <div class="col-md-4 text-end">
        <div class="badge bg-light text-dark border p-2 px-3 rounded-pill shadow-sm">
            <span class="text-muted">Usuario Activo:</span> {{ current_user.nombre }} {{ current_user.apellidos }}
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-4">
        <div class="card-nu mb-4 shadow-sm border-0">
            <h5 class="text-primary-nu mb-4 fw-bold d-flex align-items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon-nu me-2" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/><line x1="12" y1="14" x2="12" y2="18"/><line x1="10" y1="16" x2="14" y2="16"/></svg>
                Registrar Nuevo Crédito
            </h5>
            <form method="POST">
                {{ form.hidden_tag() }}
                <div class="mb-3">
                    {{ form.banco_id.label(class="fw-bold small text-muted") }} 
                    {{ form.banco_id(class="form-select bg-light") }}
                </div>
                <div class="mb-3">
                    {{ form.limite.label(class="fw-bold small text-muted") }} 
                    {{ form.limite(class="form-control bg-light", placeholder="Ej. 50000") }}
                </div>
                <div class="row">
                    <div class="col-6 mb-3">
                        {{ form.monto.label(class="fw-bold small text-muted") }} 
                        {{ form.monto(class="form-control bg-light", placeholder="Ej. 15000") }}
                    </div>
                    <div class="col-6 mb-3">
                        {{ form.tasa.label(class="fw-bold small text-muted") }} 
                        {{ form.tasa(class="form-control bg-light", placeholder="Ej. 45.5") }}
                    </div>
                </div>
                <div class="mb-4">
                    {{ form.minimo.label(class="fw-bold small text-muted") }} 
                    {{ form.minimo(class="form-control bg-light", placeholder="Ej. 800") }}
                </div>
                <div class="d-grid">
                    {{ form.submit(class="btn btn-nu fw-bold") }}
                </div>
            </form>
        </div>
    </div>

    <div class="col-md-8">
        <div class="card-nu bg-dark text-white mb-4 shadow-sm">
            <h5 class="fw-bold text-warning d-flex align-items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon-nu me-2" viewBox="0 0 24 24"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                Estrategia Calculada: Avalancha Matemática
            </h5>
            <p class="mb-0 small text-light">El algoritmo ha ordenado tus deudas. Prioriza la #1 con todo tu capital extra. Paga solo el mínimo del resto.</p>
        </div>
        
        {% for deuda in plan.lista %}
        <div class="card-nu mb-3 shadow-sm border-0 {% if loop.first %}border-start border-danger border-5{% endif %}">
            <span class="badge bg-danger p-2 mb-2 shadow-sm">Prioridad #{{ loop.index }}</span>
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h5 class="fw-bold text-dark mb-0 d-flex align-items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon-nu me-2 text-muted" viewBox="0 0 24 24"><rect x="2" y="5" width="20" height="14" rx="2"/><line x1="2" y1="10" x2="22" y2="10"/></svg>
                        {{ deuda.institucion.nombre }}
                    </h5>
                    <span class="badge bg-light text-dark border mt-2">Tasa Anual: {{ deuda.tasa }}%</span>
                </div>
                <div class="text-end">
                    <h4 class="text-danger mb-0 fw-bold">${{ "{:,.2f}".format(deuda.monto) }}</h4>
                    <small class="text-muted fw-bold">Mínimo: ${{ "{:,.2f}".format(deuda.minimo) }}</small>
                </div>
            </div>
            {% if loop.first %}
            <div class="mt-3 pt-3 border-top px-1">
                <p class="text-success fw-bold mb-0 d-flex align-items-center small">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon-nu me-2 text-success" viewBox="0 0 24 24"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                    Instrucción del Algoritmo: Esta deuda genera el mayor impacto financiero. Lliquida esta primero.
                </p>
            </div>
            {% endif %}
        </div>
        {% else %}
        <div class="text-center p-5 card-nu shadow-sm bg-light text-muted border-0">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon-nu-lg mb-3 text-muted" style="width:64px; height:64px;" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
            <h4 class="fw-bold text-dark">Tu expediente está limpio</h4>
            <p>Agrega tus tarjetas y préstamos en el panel de la izquierda para generar tu plan.</p>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}